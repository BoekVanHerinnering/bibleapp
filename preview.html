<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Verse Preview</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      background: #f3f3f3;
      font-family: sans-serif;
      text-align: center;
      padding: 20px;
    }

    #verseCard {
      position: sticky;
      top: 20px;
      z-index: 10;
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      padding: 20px;
      margin: 10px auto;
      max-width: 550px;
      height: 320px;
      overflow: hidden;
      box-sizing: border-box;
    }

    #bgLayer,
    #overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-size: cover;
      background-position: center;
      z-index: 0;
      transform-origin: center center;
      transition: transform 0.2s ease;
      pointer-events: none;
    }

    #verseContent {
      position: relative;
      z-index: 2;
      color: #fff;
      font-size: 20px;
      font-weight: bold;
      text-shadow: 2px 2px 5px black;
      padding: 20px;
      height: 100%;
      overflow-y: auto;
      white-space: pre-wrap;
      word-break: break-word;
      box-sizing: border-box;
    }

    #shareAppLink {
      font-size: 16px;
      margin-top: 90px;
      color: #0026ffd0;
      text-align: center;
      text-decoration: underline;
      text-shadow: 1px 1px 3px #000;
    }

    .controls {
      margin-top: 25px;
      max-width: 500px;
      margin-left: auto;
      margin-right: auto;
      text-align: left;
      background: #fff;
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    label {
      font-weight: bold;
      display: block;
      margin-top: 15px;
    }

    select, input[type="color"], input[type="range"], input[type="file"] {
      width: 100%;
      margin-top: 5px;
      padding: 5px;
      box-sizing: border-box;
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
</head>
<body>


  <!-- Verse Card -->
  <div id="verseCard">
    <div id="bgLayer"></div>
    <div id="overlay"></div>
    <div id="verseContent">
  <div id="verseReference"></div>
  <div id="sharePreviewText"></div>
  <div id="shareAppLink">üì• Download:http://bit.ly/3Ioq7j6</div>
</div>

  </div>

  <!-- Buttons -->
  <div class="controls">
    <button onclick="shareVerse()">üì§ Share Verse & image</button>
    <button onclick="downloadVerseImage()">üìÖ Verse & image</button>
    <button onclick="shareToWhatsApp()">üì≤ Share Verse only to WhatsApp</button>
    <button onclick="resetVerseCard()">‚ôªÔ∏è Reset All</button>
  </div>

  <!-- Background & Font Controls -->
  <div class="controls">
    <label>üé® Background Image:
      <select onchange="setBackground(this.value)">
        <option value="">-- None --</option>
        <option value="url('https://picsum.photos/id/1011/800/600')">Lady in Boat</option>
        <option value="url('images/1.png')">1</option>
<option value="url('images/2.png')">2</option>
<option value="url('images/3.png')">3</option>
<option value="url('images/4.png')">4</option>
<option value="url('images/5.png')">5</option>
<option value="url('images/6.png')">6</option>
<option value="url('images/7.png')">7</option>
<option value="url('images/8.png')">8</option>
<option value="url('images/9.png')">9</option>
<option value="url('images/10.png')">10</option>
<option value="url('images/11.png')">11</option>
<option value="url('images/12.png')">12</option>
<option value="url('images/13.png')">13</option>
<option value="url('images/14.png')">14</option>
<option value="url('images/15.png')">15</option>
<option value="url('images/16.png')">16</option>
<option value="url('images/17.png')">17</option>
<option value="url('images/18.png')">18</option>
<option value="url('images/19.png')">19</option>
<option value="url('images/20.png')">20</option>
<option value="url('images/21.png')">21</option>
<option value="url('images/app-logo.png')">22</option>

      </select>
    </label>
    <label>üì§ Upload Custom Image:
      <input type="file" accept="image/*" onchange="uploadImage(this)">
    </label>
    <label>üñçÔ∏è Overlay Color:
      <input type="color" value="#000000" onchange="setOverlayColor(this.value)">
    </label>
    <label>üîç Zoom Background:
      <input type="range" min="1" max="2.5" step="0.01" value="1" oninput="zoomBackground(this.value)">
    </label>
  </div>

  <!-- Text Settings -->
  <div class="controls">
    <h3>üìù Text Settings</h3>
    <label>Font Family:
      <select onchange="setFontFamily(this.value)">
        <option value="sans-serif">Sans Serif</option>
        <option value="serif">Serif</option>
        <option value="monospace">Monospace</option>
        <option value="'Open Sans', sans-serif">Open Sans</option>
        <option value="'Lobster', cursive">Lobster</option>
      </select>
    </label>
    <label>Font Size:
      <input type="range" min="14" max="48" value="20" oninput="setFontSize(this.value)">
      <span id="fontSizeValue">20px</span>
    </label>
    <label>Text Color:
      <input type="color" value="#ffffff" onchange="setTextColor(this.value)">
    </label>
    <label>Text Align:
      <select onchange="setTextAlign(this.value)">
        <option value="center">Center</option>
        <option value="left">Left</option>
        <option value="right">Right</option>
      </select>
    </label>
    <label>Line Height:
      <input type="range" min="1" max="3" step="0.1" value="1.5" oninput="setLineHeight(this.value)">
      <span id="lineHeightValue">1.5</span>
    </label>
  </div>

  <script>

    window.addEventListener("DOMContentLoaded", () => {
    const params = new URLSearchParams(window.location.search);
    const data = params.get("data");

    if (data) {
      try {
        const previewData = JSON.parse(decodeURIComponent(data));
        const text = previewData.text || "";
        const reference = previewData.reference || "";

        // ‚úÖ Replace this with your real HTML elements
        document.getElementById("previewText").innerText = text;
        document.getElementById("referenceTitle").innerText = reference;

      } catch (err) {
        console.error("Error decoding preview data:", err);
      }
    } else {
      console.warn("No verse data found in URL.");
    }
  });








    function updateTransform() {
  const cardHeight = document.getElementById('verseCard').offsetHeight;
  bgLayer.style.height = cardHeight + 'px';
  overlay.style.height = cardHeight + 'px';
  bgLayer.style.transform = `translate(${offsetX}px, ${offsetY}px) scale(${scale})`;
}





    const bgLayer = document.getElementById('bgLayer');
    const overlay = document.getElementById('overlay');
    let scale = 1, offsetX = 0, offsetY = 0, isDragging = false, startX, startY;

    function setBackground(value) {
      bgLayer.style.backgroundImage = value.startsWith("url(") ? value : "";
      bgLayer.style.backgroundColor = value.startsWith("url(") ? "" : value;
      resetPan();
    }

    function uploadImage(input) {
      const file = input.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = e => {
        bgLayer.style.backgroundImage = `url('${e.target.result}')`;
        bgLayer.style.backgroundColor = "";
        resetPan();
      };
      reader.readAsDataURL(file);
    }

    function setOverlayColor(color) {
      overlay.style.backgroundColor = hexToRGBA(color, 0.3);
    }

    function zoomBackground(value) {
      scale = parseFloat(value);
      updateTransform();
    }

    function resetPan() {
      scale = 1; offsetX = 0; offsetY = 0;
      updateTransform();
    }

    function updateTransform() {
      bgLayer.style.transform = `translate(${offsetX}px, ${offsetY}px) scale(${scale})`;
    }

    function hexToRGBA(hex, alpha) {
      const r = parseInt(hex.slice(1, 3), 16);
      const g = parseInt(hex.slice(3, 5), 16);
      const b = parseInt(hex.slice(5, 7), 16);
      return `rgba(${r},${g},${b},${alpha})`;
    }

    bgLayer.addEventListener("mousedown", e => {
      isDragging = true;
      startX = e.clientX - offsetX;
      startY = e.clientY - offsetY;
      bgLayer.style.cursor = "grabbing";
    });

    window.addEventListener("mouseup", () => {
      isDragging = false;
      bgLayer.style.cursor = "grab";
    });

    window.addEventListener("mousemove", e => {
      if (!isDragging) return;
      offsetX = e.clientX - startX;
      offsetY = e.clientY - startY;
      updateTransform();
    });

    bgLayer.addEventListener("touchstart", e => {
      if (e.touches.length === 1) {
        isDragging = true;
        const touch = e.touches[0];
        startX = touch.clientX - offsetX;
        startY = touch.clientY - offsetY;
      }
    });

    bgLayer.addEventListener("touchmove", e => {
      if (!isDragging || e.touches.length !== 1) return;
      const touch = e.touches[0];
      offsetX = touch.clientX - startX;
      offsetY = touch.clientY - startY;
      updateTransform();
    });

    bgLayer.addEventListener("touchend", () => {
      isDragging = false;
    });

    function setFontFamily(value) {
      document.getElementById('verseContent').style.fontFamily = value;
    }

    function setFontSize(value) {
      document.getElementById('verseContent').style.fontSize = value + 'px';
      document.getElementById('fontSizeValue').innerText = value + 'px';
    }

    function setTextColor(value) {
      document.getElementById('verseContent').style.color = value;
    }

    function setTextAlign(value) {
      document.getElementById('verseContent').style.textAlign = value;
    }

    function setLineHeight(value) {
      document.getElementById('verseContent').style.lineHeight = value;
      document.getElementById('lineHeightValue').innerText = value;
    }

    function downloadVerseImage() {
  cloneAndRenderCard(canvas => {
    const link = document.createElement("a");
    link.download = "verse.png";
    link.href = canvas.toDataURL();
    link.click();
  });
}

function cloneAndRenderCard(callback) {
  const original = document.getElementById('verseCard');
  const clone = original.cloneNode(true);

  // Style the clone for full rendering
  clone.style.height = 'auto';
  clone.style.overflow = 'visible';
  clone.style.position = 'absolute';
  clone.style.left = '-9999px';
  clone.style.top = '0';
  clone.style.zIndex = '-1';

  // Append to body, render, then remove
  document.body.appendChild(clone);

  html2canvas(clone).then(canvas => {
    document.body.removeChild(clone);
    callback(canvas);
  });
}
    function copyMessage() {
      const verseRef = document.getElementById('verseReference').textContent;
      const verseText = document.getElementById('sharePreviewText').textContent;
      const message = `üìñ ${verseRef}\n${verseText}\n\nüì• Download the Bible App:\nhttps://boekvanherinnering.github.io`;
      navigator.clipboard.writeText(message).then(() => {
        alert("‚úÖ Message copied!\nPaste in WhatsApp or Messenger.");
      });
    }

    async function shareOnlyImage() {
      const verseCard = document.getElementById('verseCard');
      const canvas = await html2canvas(verseCard);
      canvas.toBlob(blob => {
        const file = new File([blob], 'verse.png', { type: 'image/png' });

        if (navigator.canShare && navigator.canShare({ files: [file] })) {
          navigator.share({ title: 'Verse Image', files: [file] });
        } else {
          const link = document.createElement("a");
          link.href = URL.createObjectURL(blob);
          link.download = "verse.png";
          link.click();
          alert("‚úÖ Image saved. Share manually if needed.");
        }
      });
    }

    async function shareVerse() {
  cloneAndRenderCard(async canvas => {
    canvas.toBlob(async blob => {
      const file = new File([blob], "verse.png", { type: "image/png" });

      const verseRef = document.getElementById('verseReference').textContent;
      const verseText = document.getElementById('sharePreviewText').textContent;

      const message = `üìñ *${verseRef}*\n${verseText}\n\nüì• *Download the Bible App:*\nhttp://bit.ly/3Ioq7j6`;

      if (navigator.canShare && navigator.canShare({ files: [file] })) {
        await navigator.share({
          title: 'Bible Verse',
          text: message,
          files: [file]
        });
      } else {
        const downloadLink = document.createElement("a");
        downloadLink.href = URL.createObjectURL(blob);
        downloadLink.download = "verse.png";
        downloadLink.click();

        navigator.clipboard.writeText(message).then(() => {
          alert("‚úÖ Image saved. App link copied to clipboard:\n" + message);
        }).catch(() => {
          alert("‚úÖ Image saved.\n‚ö†Ô∏è Please copy this link:\n" + message);
        });
      }
    });
  });
}

    function shareToWhatsApp() {
  const verseRef = document.getElementById('verseReference').textContent;
  const verseText = document.getElementById('sharePreviewText').textContent;
  const message = `üìñ ${verseRef}\n${verseText}\n\nüì• Download the Bible App:\nhttp://bit.ly/3Ioq7j6`;

  const encoded = encodeURIComponent(message);
  window.open(`https://wa.me/?text=${encoded}`, "_blank");
}

function resetVerseCard() {
  // Reset background
  bgLayer.style.backgroundImage = "";
  bgLayer.style.backgroundColor = "";
  overlay.style.backgroundColor = "rgba(0,0,0,0.3)";
  resetPan();

  // Reset text
  document.getElementById('verseContent').style.fontFamily = "sans-serif";
  document.getElementById('verseContent').style.fontSize = "20px";
  document.getElementById('verseContent').style.color = "#ffffff";
  document.getElementById('verseContent').style.textAlign = "center";
  document.getElementById('verseContent').style.lineHeight = "1.5";

  // Reset controls (if shown)
  document.querySelector('select[onchange="setFontFamily(this.value)"]').value = "sans-serif";
  document.querySelector('input[oninput="setFontSize(this.value)"]').value = 20;
  document.getElementById('fontSizeValue').innerText = "20px";
  document.querySelector('input[onchange="setTextColor(this.value)"]').value = "#ffffff";
  document.querySelector('select[onchange="setTextAlign(this.value)"]').value = "center";
  document.querySelector('input[oninput="setLineHeight(this.value)"]').value = 1.5;
  document.getElementById('lineHeightValue').innerText = "1.5";
  document.querySelector('select[onchange="setBackground(this.value)"]').value = "";
  document.querySelector('input[onchange="setOverlayColor(this.value)"]').value = "#000000";
}

window.addEventListener("DOMContentLoaded", () => {
  const params = new URLSearchParams(window.location.search);
  const dataParam = params.get("data");
  if (!dataParam) return;

  try {
    const { reference, text } = JSON.parse(decodeURIComponent(dataParam));
    document.getElementById("verseReference").textContent = reference || "";
    document.getElementById("sharePreviewText").textContent = text || "";
  } catch (err) {
    console.error("Failed to parse preview data:", err);
  }
});


  </script>

</body>
</html>