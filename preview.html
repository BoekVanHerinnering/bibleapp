<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Verse Preview</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
  margin: 0;
  padding: 20px;
  font-family: sans-serif;
  background: #f3f3f3;
}

.container {
  display: flex;
  max-width: 900px;
  margin: auto;
  gap: 20px;
  height: 80vh; /* limit vertical height for scrolling */
}

.preview-column {
  flex: 1 1 300px;
  position: sticky;
  top: 20px; /* sticky distance from top */
  align-self: start;
  max-height: calc(80vh - 20px);
  overflow: auto; /* if preview grows tall */
  background: white;
  padding: 10px;
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
}

.controls-column {
  flex: 1 1 400px;
  overflow-y: auto;
  max-height: 80vh;
  background: white;
  padding: 10px;
  border-radius: 12px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}


    #verseCard {
  width: 90%;
  max-width: 500px;
  /* height: 300px; */  /* ‚úÖ Remove or disable this line */
  min-height: 300px;
  padding: 20px;
  position: relative;
  margin: auto;
  overflow: hidden;
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
  background-color: #fff;
}

#verseContent {
  white-space: pre-wrap;
  word-break: break-word;
}



    #bgLayer {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-size: cover;
      background-position: center;
      z-index: 0;
      transform-origin: center center;
      transition: transform 0.2s ease;
      cursor: grab;
    }

    #overlay {
      position: absolute;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.3);
      z-index: 1;
      pointer-events: none;
    }

    #verseContent {
      position: relative;
      z-index: 2;
      color: #fff;
      font-size: 20px;
      font-weight: bold;
      text-shadow: 2px 2px 5px black;
      padding: 20px;
    }

    #shareAppLink {
      font-size: 14px;
      margin-top: 12px;
      color: #fff;
      text-shadow: 1px 1px 3px #000;
    }

    .controls {
      margin-top: 25px;
      max-width: 500px;
      margin-left: auto;
      margin-right: auto;
      text-align: left;
      background: #fff;
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    label {
      font-weight: bold;
      display: block;
      margin-top: 15px;
    }

    select, input[type="color"], input[type="range"], input[type="file"] {
      width: 100%;
      margin-top: 5px;
      padding: 5px;
      box-sizing: border-box;
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
</head>
<body>


  <div class="container">
  <div class="preview-column">
    <div id="verseCard">
      <div id="bgLayer"></div>
      <div id="overlay"></div>
      <div id="verseContent">
        <div id="verseReference">Genesis 1:1</div>
        <div id="sharePreviewText">In the beginning God created the heavens and the earth.</div>
        <div id="shareAppLink">üì• Download: boekvanherinnering.github.io</div>
      </div>
    </div>
  </div>

  <div class="controls-column">
    <!-- Move all your controls here -->
    <div class="controls">
      <button onclick="shareVerse()">üì§ Share Verse</button>
      <button onclick="downloadVerseImage()">üíæ Download Image</button>
      <button onclick="shareOnlyImage()">üñºÔ∏è Share Image Only</button>
      <button onclick="copyMessage()">üìã Copy Verse + App Link</button>
      <button onclick="shareToWhatsApp()">üì≤ Share to WhatsApp</button>
    </div>

    <div class="controls">
      <label>üé® Background Image:
        <select onchange="setBackground(this.value)">
          <option value="">-- None --</option>
          <option value="url('https://picsum.photos/id/1011/800/600')">Lady in Boat</option>
          <option value="url('images/wall.jpg')">üß± Wall</option>
          <option value="url('images/gravel.png')">ü™® Gravel</option>
        </select>
      </label>

      <label>üì§ Upload Custom Image:
        <input type="file" accept="image/*" onchange="uploadImage(this)">
      </label>

      <label>üñçÔ∏è Overlay Color:
        <input type="color" value="#000000" onchange="setOverlayColor(this.value)">
      </label>

      <label>üîç Zoom Background:
        <input type="range" min="1" max="2.5" step="0.01" value="1" oninput="zoomBackground(this.value)">
      </label>
    </div>

    <div class="controls">
      <h3>üìù Text Settings</h3>
      <label>Font Family:
        <select onchange="setFontFamily(this.value)">
          <option value="sans-serif">Sans Serif</option>
          <option value="serif">Serif</option>
          <option value="monospace">Monospace</option>
          <option value="'Open Sans', sans-serif">Open Sans</option>
          <option value="'Lobster', cursive">Lobster</option>
        </select>
      </label>

      <label>Font Size:
        <input type="range" min="14" max="48" value="20" oninput="setFontSize(this.value)">
        <span id="fontSizeValue">20px</span>
      </label>

      <label>Text Color:
        <input type="color" value="#ffffff" onchange="setTextColor(this.value)">
      </label>

      <label>Text Align:
        <select onchange="setTextAlign(this.value)">
          <option value="center">Center</option>
          <option value="left">Left</option>
          <option value="right">Right</option>
        </select>
      </label>

      <label>Line Height:
        <input type="range" min="1" max="3" step="0.1" value="1.5" oninput="setLineHeight(this.value)">
        <span id="lineHeightValue">1.5</span>
      </label>
    </div>
  </div>
</div>


  <script>
    const bgLayer = document.getElementById('bgLayer');
    const overlay = document.getElementById('overlay');
    let scale = 1, offsetX = 0, offsetY = 0, isDragging = false, startX, startY;

    function setBackground(value) {
      bgLayer.style.backgroundImage = value.startsWith("url(") ? value : "";
      bgLayer.style.backgroundColor = value.startsWith("url(") ? "" : value;
      resetPan();
    }

    function uploadImage(input) {
      const file = input.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = e => {
        bgLayer.style.backgroundImage = `url('${e.target.result}')`;
        bgLayer.style.backgroundColor = "";
        resetPan();
      };
      reader.readAsDataURL(file);
    }

    function setOverlayColor(color) {
      overlay.style.backgroundColor = hexToRGBA(color, 0.3);
    }

    function zoomBackground(value) {
      scale = parseFloat(value);
      updateTransform();
    }

    function resetPan() {
      scale = 1; offsetX = 0; offsetY = 0;
      updateTransform();
    }

    function updateTransform() {
      bgLayer.style.transform = `translate(${offsetX}px, ${offsetY}px) scale(${scale})`;
    }

    function hexToRGBA(hex, alpha) {
      const r = parseInt(hex.slice(1, 3), 16);
      const g = parseInt(hex.slice(3, 5), 16);
      const b = parseInt(hex.slice(5, 7), 16);
      return `rgba(${r},${g},${b},${alpha})`;
    }

    bgLayer.addEventListener("mousedown", e => {
      isDragging = true;
      startX = e.clientX - offsetX;
      startY = e.clientY - offsetY;
      bgLayer.style.cursor = "grabbing";
    });

    window.addEventListener("mouseup", () => {
      isDragging = false;
      bgLayer.style.cursor = "grab";
    });

    window.addEventListener("mousemove", e => {
      if (!isDragging) return;
      offsetX = e.clientX - startX;
      offsetY = e.clientY - startY;
      updateTransform();
    });

    bgLayer.addEventListener("touchstart", e => {
      if (e.touches.length === 1) {
        isDragging = true;
        const touch = e.touches[0];
        startX = touch.clientX - offsetX;
        startY = touch.clientY - offsetY;
      }
    });

    bgLayer.addEventListener("touchmove", e => {
      if (!isDragging || e.touches.length !== 1) return;
      const touch = e.touches[0];
      offsetX = touch.clientX - startX;
      offsetY = touch.clientY - startY;
      updateTransform();
    });

    bgLayer.addEventListener("touchend", () => {
      isDragging = false;
    });

    function setFontFamily(value) {
      document.getElementById('verseContent').style.fontFamily = value;
    }

    function setFontSize(value) {
      document.getElementById('verseContent').style.fontSize = value + 'px';
      document.getElementById('fontSizeValue').innerText = value + 'px';
    }

    function setTextColor(value) {
      document.getElementById('verseContent').style.color = value;
    }

    function setTextAlign(value) {
      document.getElementById('verseContent').style.textAlign = value;
    }

    function setLineHeight(value) {
      document.getElementById('verseContent').style.lineHeight = value;
      document.getElementById('lineHeightValue').innerText = value;
    }

    function downloadVerseImage() {
      const verseCard = document.getElementById('verseCard');
      html2canvas(verseCard).then(canvas => {
        const link = document.createElement("a");
        link.download = "verse.png";
        link.href = canvas.toDataURL();
        link.click();
      });
    }

    function copyMessage() {
      const verseRef = document.getElementById('verseReference').textContent;
      const verseText = document.getElementById('sharePreviewText').textContent;
      const message = `üìñ ${verseRef}\n${verseText}\n\nüì• Download the Bible App:\nhttps://boekvanherinnering.github.io`;
      navigator.clipboard.writeText(message).then(() => {
        alert("‚úÖ Message copied!\nPaste in WhatsApp or Messenger.");
      });
    }

    async function shareOnlyImage() {
      const verseCard = document.getElementById('verseCard');
      const canvas = await html2canvas(verseCard);
      canvas.toBlob(blob => {
        const file = new File([blob], 'verse.png', { type: 'image/png' });

        if (navigator.canShare && navigator.canShare({ files: [file] })) {
          navigator.share({ title: 'Verse Image', files: [file] });
        } else {
          const link = document.createElement("a");
          link.href = URL.createObjectURL(blob);
          link.download = "verse.png";
          link.click();
          alert("‚úÖ Image saved. Share manually if needed.");
        }
      });
    }

    async function shareVerse() {
      const verseCard = document.getElementById('verseCard');
      const verseRef = document.getElementById('verseReference').textContent;
      const verseText = document.getElementById('sharePreviewText').textContent;
      const message = `üìñ ${verseRef}\n${verseText}\n\nüì• Download the Bible App:\nhttps://boekvanherinnering.github.io`;

      try {
        const canvas = await html2canvas(verseCard);
        const blob = await new Promise(resolve => canvas.toBlob(resolve, 'image/png'));
        const file = new File([blob], "verse.png", { type: "image/png" });

        if (navigator.canShare && navigator.canShare({ files: [file] })) {
          await navigator.share({ title: 'Bible Verse', text: message, files: [file] });
        } else {
          const downloadLink = document.createElement("a");
          downloadLink.href = URL.createObjectURL(blob);
          downloadLink.download = "verse.png";
          downloadLink.click();
          await navigator.clipboard.writeText(message);
          alert("‚úÖ Image downloaded and app link copied!");
        }
      } catch (err) {
        console.error("Sharing failed:", err);
        alert("‚ùå Could not share the verse.");
      }
    }

    function shareToWhatsApp() {
  const verseRef = document.getElementById('verseReference').textContent;
  const verseText = document.getElementById('sharePreviewText').textContent;
  const message = `üìñ ${verseRef}\n${verseText}\n\nüì• Download the Bible App:\nhttps://boekvanherinnering.github.io`;

  const encoded = encodeURIComponent(message);
  window.open(`https://wa.me/?text=${encoded}`, "_blank");
}

  </script>

</body>
</html>
